---
import Layout from "../layouts/Layout.astro";

// Welcome to Astro! Wondering what to do next? Check out the Astro documentation at https://docs.astro.build
// Don't want to use any of this? Delete everything in this file, the `assets`, `components`, and `layouts` directories, and start fresh.
---

<Layout />

<script>
  import * as Three from "three";
  import { initThreeScene, type SceneBundle } from "../lib/renderer";
  import { initGui } from "../lib/gui";

  const { scene, camera, renderer } = initThreeScene(customLooper);

  // Objects setup
  const geometry = new Three.BoxGeometry(1, 1, 1);
  const material = new Three.MeshBasicMaterial({
    color: 0x00ff00,
    wireframe: true,
  });
  const cube = new Three.Mesh(geometry, material);
  cube.name = "myCube";
  scene.add(cube);

  function customLooper(sb: SceneBundle) {
    const cube = sb.scene.getObjectByName("myCube");
    if (cube) {
      cube.rotation.x += 0.01;
      cube.rotation.y += 0.01;
    }
    sb.renderer.render(sb.scene, sb.camera);
  }

  // Initialize Dat GUI
  initGui(camera);

  const tanFOV = Math.tan(((Math.PI / 180) * camera.fov) / 2);
  const windowHeight = window.innerHeight;

  window.addEventListener("resize", onWindowResize, false);

  function onWindowResize(event: Event) {
    camera.aspect = window.innerWidth / window.innerHeight;

    // adjust the FOV
    camera.fov =
      (360 / Math.PI) * Math.atan(tanFOV * (window.innerHeight / windowHeight));

    camera.updateProjectionMatrix();
    camera.lookAt(scene.position);

    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.render(scene, camera);
  }
</script>
